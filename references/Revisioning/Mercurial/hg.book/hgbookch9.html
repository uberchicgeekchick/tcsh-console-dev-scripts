<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>9 Finding and fixing your mistakes</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<!-- html4-uni,2,html,xhtml --> 
<meta name="src" content="hgbook.tex" /> 
<meta name="date" content="2007-12-14 11:09:00" /> 
<link rel="stylesheet" type="text/css" href="hgbook.css" /> 
</head><body 
>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="hgbookch10.html" >next</a>] [<a 
href="hgbookch8.html" >prev</a>] [<a 
href="hgbookch8.html#tailhgbookch8.html" >prev-tail</a>] [<a 
href="#tailhgbookch9.html">tail</a>] [<a 
href="hgbook.html#hgbookch9.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;9</span><br /><a 
 id="x13-1690009"></a>Finding and fixing your mistakes</h2>
<!--l. 4--><p class="noindent" >To err might be human, but to really handle the consequences well takes a top-notch revision control system. In this chapter,
we&#x2019;ll discuss some of the techniques you can use when you find that a problem has crept into your project.
Mercurial has some highly capable features that will help you to isolate the sources of problems, and to handle them
appropriately.
</p>
   <h3 class="sectionHead"><span class="titlemark">9.1    </span> <a 
 id="x13-1700009.1"></a>Erasing local history</h3>
<!--l. 13--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.1.1    </span> <a 
 id="x13-1710009.1.1"></a>The accidental commit</h4>
<!--l. 15--><p class="noindent" >I have the occasional but persistent problem of typing rather more quickly than I can think, which sometimes results in me
committing a changeset that is either incomplete or plain wrong. In my case, the usual kind of incomplete changeset is one in
which I&#x2019;ve created a new source file, but forgotten to <a 
 id="dx13-171001"></a>&#x201C;<span 
class="pcrr7tn-">hg add</span>&#x201D; it. A &#x201C;plain wrong&#x201D; changeset is not as common, but no less
annoying.
</p><!--l. 22--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.1.2    </span> <a 
 id="x13-1720009.1.2"></a>Rolling back a transaction</h4>
<!--l. 25--><p class="noindent" >In section&#x00A0;<a 
href="hgbookch4.html#x8-720004.2.2">4.2.2<!--tex4ht:ref: sec:concepts:txn --></a>, I mentioned that Mercurial treats each modification of a repository as a <span 
class="ptmri7t-">transaction</span>. Every time you commit a
changeset or pull changes from another repository, Mercurial remembers what you did. You can undo, or <span 
class="ptmri7t-">roll back</span>, exactly one
of these actions using the <a 
 id="dx13-172001"></a>&#x201C;<span 
class="pcrr7tn-">hg rollback</span>&#x201D; command. (See section&#x00A0;<a 
href="#x13-1740009.1.4">9.1.4<!--tex4ht:ref: sec:undo:rollback-after-push --></a> for an important caveat about the use of this
command.)
</p><!--l. 33--><p class="indent" >   Here&#x2019;s a mistake that I often find myself making: committing a change in which I&#x2019;ve created a new file, but forgotten to <a 
 id="dx13-172002"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">add</span>&#x201D; it.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-172004r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-172006r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;M</span><span 
class="pcrr7tn-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x13-172008r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;b</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;b</span>
<br class="fancyvrb" /><a 
 id="x13-172010r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'Add</span><span 
class="pcrb7t-">&#x00A0;file</span><span 
class="pcrb7t-">&#x00A0;b'</span>
   </div>
<!--l. 36--><p class="noindent" >Looking at the output of <a 
 id="dx13-172011"></a>&#x201C;<span 
class="pcrr7tn-">hg status</span>&#x201D; after the commit immediately confirms the error.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-172013r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-172015r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;?</span><span 
class="pcrr7tn-">&#x00A0;b</span>
<br class="fancyvrb" /><a 
 id="x13-172017r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x13-172019r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1:8a557de9a817</span>
<br class="fancyvrb" /><a 
 id="x13-172021r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x13-172023r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x13-172025r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Mon</span><span 
class="pcrr7tn-">&#x00A0;Dec</span><span 
class="pcrr7tn-">&#x00A0;10</span><span 
class="pcrr7tn-">&#x00A0;19:54:38</span><span 
class="pcrr7tn-">&#x00A0;2007</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x13-172027r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Add</span><span 
class="pcrr7tn-">&#x00A0;file</span><span 
class="pcrr7tn-">&#x00A0;b</span>
<br class="fancyvrb" /><a 
 id="x13-172029r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
                                                                                         
                                                                                         
   </div>
<!--l. 39--><p class="noindent" >The commit captured the changes to the file <span 
class="pcrr7tn-">a</span>, but not the new file <span 
class="pcrr7tn-">b</span>. If I were to push this changeset to a repository that I shared
with a colleague, the chances are high that something in <span 
class="pcrr7tn-">a </span>would refer to <span 
class="pcrr7tn-">b</span>, which would not be present in their repository when
they pulled my changes. I would thus become the object of some indignation.
</p><!--l. 46--><p class="indent" >   However, luck is with me&#x2014;I&#x2019;ve caught my error before I pushed the changeset. I use the <a 
 id="dx13-172030"></a>&#x201C;<span 
class="pcrr7tn-">hg rollback</span>&#x201D; command, and
Mercurial makes that last changeset vanish.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-172032r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;rollback</span>
<br class="fancyvrb" /><a 
 id="x13-172034r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;rolling</span><span 
class="pcrr7tn-">&#x00A0;back</span><span 
class="pcrr7tn-">&#x00A0;last</span><span 
class="pcrr7tn-">&#x00A0;transaction</span>
<br class="fancyvrb" /><a 
 id="x13-172036r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x13-172038r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;0:15f839321f52</span>
<br class="fancyvrb" /><a 
 id="x13-172040r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x13-172042r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x13-172044r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Mon</span><span 
class="pcrr7tn-">&#x00A0;Dec</span><span 
class="pcrr7tn-">&#x00A0;10</span><span 
class="pcrr7tn-">&#x00A0;19:54:38</span><span 
class="pcrr7tn-">&#x00A0;2007</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x13-172046r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;First</span><span 
class="pcrr7tn-">&#x00A0;commit</span>
<br class="fancyvrb" /><a 
 id="x13-172048r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-172050r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-172052r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;M</span><span 
class="pcrr7tn-">&#x00A0;a</span>
<br class="fancyvrb" /><a 
 id="x13-172054r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;?</span><span 
class="pcrr7tn-">&#x00A0;b</span>
   </div>
<!--l. 50--><p class="noindent" >Notice that the changeset is no longer present in the repository&#x2019;s history, and the working directory once again thinks
that the file <span 
class="pcrr7tn-">a </span>is modified. The commit and rollback have left the working directory exactly as it was prior to
the commit; the changeset has been completely erased. I can now safely <a 
 id="dx13-172055"></a>&#x201C;<span 
class="pcrr7tn-">hg add</span>&#x201D; the file <span 
class="pcrr7tn-">b</span>, and rerun my
commit.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-172057r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;add</span><span 
class="pcrb7t-">&#x00A0;b</span>
<br class="fancyvrb" /><a 
 id="x13-172059r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'Add</span><span 
class="pcrb7t-">&#x00A0;file</span><span 
class="pcrb7t-">&#x00A0;b,</span><span 
class="pcrb7t-">&#x00A0;this</span><span 
class="pcrb7t-">&#x00A0;time</span><span 
class="pcrb7t-">&#x00A0;for</span><span 
class="pcrb7t-">&#x00A0;real'</span>
   </div>
<!--l. 58--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.1.3    </span> <a 
 id="x13-1730009.1.3"></a>The erroneous pull</h4>
<!--l. 60--><p class="noindent" >It&#x2019;s common practice with Mercurial to maintain separate development branches of a project in different repositories. Your
development team might have one shared repository for your project&#x2019;s &#x201C;0.9&#x201D; release, and another, containing different changes,
for the &#x201C;1.0&#x201D; release.
</p><!--l. 66--><p class="indent" >   Given this, you can imagine that the consequences could be messy if you had a local &#x201C;0.9&#x201D; repository, and
accidentally pulled changes from the shared &#x201C;1.0&#x201D; repository into it. At worst, you could be paying insufficient
attention, and push those changes into the shared &#x201C;0.9&#x201D; tree, confusing your entire team (but don&#x2019;t worry, we&#x2019;ll
return to this horror scenario later). However, it&#x2019;s more likely that you&#x2019;ll notice immediately, because Mercurial
will display the URL it&#x2019;s pulling from, or you will see it pull a suspiciously large number of changes into the
repository.
</p><!--l. 76--><p class="indent" >   The <a 
 id="dx13-173001"></a>&#x201C;<span 
class="pcrr7tn-">hg rollback</span>&#x201D; command will work nicely to expunge all of the changesets that you just pulled. Mercurial groups
all changes from one <a 
 id="dx13-173002"></a>&#x201C;<span 
class="pcrr7tn-">hg pull</span>&#x201D; into a single transaction, so one <a 
 id="dx13-173003"></a>&#x201C;<span 
class="pcrr7tn-">hg rollback</span>&#x201D; is all you need to undo this
mistake.
                                                                                         
                                                                                         
</p><!--l. 81--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.1.4    </span> <a 
 id="x13-1740009.1.4"></a>Rolling back is useless once you&#x2019;ve pushed</h4>
<!--l. 84--><p class="noindent" >The value of the <a 
 id="dx13-174001"></a>&#x201C;<span 
class="pcrr7tn-">hg rollback</span>&#x201D; command drops to zero once you&#x2019;ve pushed your changes to another repository. Rolling
back a change makes it disappear entirely, but <span 
class="ptmri7t-">only </span>in the repository in which you perform the <a 
 id="dx13-174002"></a>&#x201C;<span 
class="pcrr7tn-">hg rollback</span>&#x201D;.
Because a rollback eliminates history, there&#x2019;s no way for the disappearance of a change to propagate between
repositories.
</p><!--l. 91--><p class="indent" >   If you&#x2019;ve pushed a change to another repository&#x2014;particularly if it&#x2019;s a shared repository&#x2014;it has essentially &#x201C;escaped into the
wild,&#x201D; and you&#x2019;ll have to recover from your mistake in a different way. What will happen if you push a changeset
somewhere, then roll it back, then pull from the repository you pushed to, is that the changeset will reappear in your
repository.
</p><!--l. 98--><p class="indent" >   (If you absolutely know for sure that the change you want to roll back is the most recent change in the repository that you
pushed to, <span 
class="ptmri7t-">and </span>you know that nobody else could have pulled it from that repository, you can roll back the changeset there, too,
but you really should really not rely on this working reliably. If you do this, sooner or later a change really
will make it into a repository that you don&#x2019;t directly control (or have forgotten about), and come back to bite
you.)
</p><!--l. 107--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.1.5    </span> <a 
 id="x13-1750009.1.5"></a>You can only roll back once</h4>
<!--l. 109--><p class="noindent" >Mercurial stores exactly one transaction in its transaction log; that transaction is the most recent one that occurred in the
repository. This means that you can only roll back one transaction. If you expect to be able to roll back one transaction, then its
predecessor, this is not the behaviour you will get.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-175002r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;rollback</span>
<br class="fancyvrb" /><a 
 id="x13-175004r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;rolling</span><span 
class="pcrr7tn-">&#x00A0;back</span><span 
class="pcrr7tn-">&#x00A0;last</span><span 
class="pcrr7tn-">&#x00A0;transaction</span>
<br class="fancyvrb" /><a 
 id="x13-175006r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;rollback</span>
<br class="fancyvrb" /><a 
 id="x13-175008r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;no</span><span 
class="pcrr7tn-">&#x00A0;rollback</span><span 
class="pcrr7tn-">&#x00A0;information</span><span 
class="pcrr7tn-">&#x00A0;available</span>
   </div>
<!--l. 115--><p class="noindent" >Once you&#x2019;ve rolled back one transaction in a repository, you can&#x2019;t roll back again in that repository until you perform another
commit or pull.
</p><!--l. 119--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">9.2    </span> <a 
 id="x13-1760009.2"></a>Reverting the mistaken change</h3>
<!--l. 121--><p class="noindent" >If you make a modification to a file, and decide that you really didn&#x2019;t want to change the file at all, and you haven&#x2019;t yet
committed your changes, the <a 
 id="dx13-176001"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; command is the one you&#x2019;ll need. It looks at the changeset that&#x2019;s the parent of the
working directory, and restores the contents of the file to their state as of that changeset. (That&#x2019;s a long-winded way of saying
that, in the normal case, it undoes your modifications.)
</p><!--l. 129--><p class="indent" >   Let&#x2019;s illustrate how the <a 
 id="dx13-176002"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; command works with yet another small example. We&#x2019;ll begin by modifying a file that
Mercurial is already tracking.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-176004r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-176006r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;original</span><span 
class="pcrr7tn-">&#x00A0;content</span>
<br class="fancyvrb" /><a 
 id="x13-176008r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;unwanted</span><span 
class="pcrb7t-">&#x00A0;change</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;file</span>
                                                                                         
                                                                                         
<br class="fancyvrb" /><a 
 id="x13-176010r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;diff</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-176012r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;diff</span><span 
class="pcrr7tn-">&#x00A0;-r</span><span 
class="pcrr7tn-">&#x00A0;7365fa775ae5</span><span 
class="pcrr7tn-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-176014r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;---</span><span 
class="pcrr7tn-">&#x00A0;a/file        Mon</span><span 
class="pcrr7tn-">&#x00A0;Dec</span><span 
class="pcrr7tn-">&#x00A0;10</span><span 
class="pcrr7tn-">&#x00A0;19:54:27</span><span 
class="pcrr7tn-">&#x00A0;2007</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x13-176016r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+++</span><span 
class="pcrr7tn-">&#x00A0;b/file        Mon</span><span 
class="pcrr7tn-">&#x00A0;Dec</span><span 
class="pcrr7tn-">&#x00A0;10</span><span 
class="pcrr7tn-">&#x00A0;19:54:27</span><span 
class="pcrr7tn-">&#x00A0;2007</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x13-176018r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;-1,1</span><span 
class="pcrr7tn-">&#x00A0;+1,2</span><span 
class="pcrr7tn-">&#x00A0;@@</span><span 
class="pcrr7tn-">&#x00A0;original</span><span 
class="pcrr7tn-">&#x00A0;content</span>
<br class="fancyvrb" /><a 
 id="x13-176020r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;original</span><span 
class="pcrr7tn-">&#x00A0;content</span>
<br class="fancyvrb" /><a 
 id="x13-176022r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;+unwanted</span><span 
class="pcrr7tn-">&#x00A0;change</span>
   </div>
<!--l. 133--><p class="noindent" >If we don&#x2019;t want that change, we can simply <a 
 id="dx13-176023"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; the file.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-176025r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-176027r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;M</span><span 
class="pcrr7tn-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-176029r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;revert</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-176031r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-176033r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;original</span><span 
class="pcrr7tn-">&#x00A0;content</span>
   </div>
<!--l. 135--><p class="noindent" >The <a 
 id="dx13-176034"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; command provides us with an extra degree of safety by saving our modified file with a <span 
class="pcrr7tn-">.orig</span>
extension.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-176036r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-176038r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;?</span><span 
class="pcrr7tn-">&#x00A0;file.orig</span>
<br class="fancyvrb" /><a 
 id="x13-176040r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;file.orig</span>
<br class="fancyvrb" /><a 
 id="x13-176042r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;original</span><span 
class="pcrr7tn-">&#x00A0;content</span>
<br class="fancyvrb" /><a 
 id="x13-176044r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;unwanted</span><span 
class="pcrr7tn-">&#x00A0;change</span>
   </div>
<!--l. 139--><p class="indent" >   Here is a summary of the cases that the <a 
 id="dx13-176045"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; command can deal with. We will describe each of these in more detail
in the section that follows. </p>
     <ul><li><span class="dt">
     </span><span class="dd">If you modify a file, it will restore the file to its unmodified state.
     </span><li><span class="dt">
     </span><span class="dd">If you <a 
 id="dx13-176046"></a>&#x201C;<span 
class="pcrr7tn-">hg add</span>&#x201D; a file, it will undo the &#x201C;added&#x201D; state of the file, but leave the file itself untouched.
     </span><li><span class="dt">
     </span><span class="dd">If you delete a file without telling Mercurial, it will restore the file to its unmodified contents.
     </span><li><span class="dt">
     </span><span class="dd">If you use the <a 
 id="dx13-176047"></a>&#x201C;<span 
class="pcrr7tn-">hg remove</span>&#x201D; command to remove a file, it will undo the &#x201C;removed&#x201D; state of the file, and restore
     the file to its unmodified contents.</li></ul>
<!--l. 154--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.2.1    </span> <a 
 id="x13-1770009.2.1"></a>File management errors</h4>
<!--l. 157--><p class="noindent" >The <a 
 id="dx13-177001"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; command is useful for more than just modified files. It lets you reverse the results of all of Mercurial&#x2019;s file
management commands&#x2014;<a 
 id="dx13-177002"></a>&#x201C;<span 
class="pcrr7tn-">hg add</span>&#x201D;, <a 
 id="dx13-177003"></a>&#x201C;<span 
class="pcrr7tn-">hg remove</span>&#x201D;, and so on.
</p><!--l. 161--><p class="indent" >   If you <a 
 id="dx13-177004"></a>&#x201C;<span 
class="pcrr7tn-">hg add</span>&#x201D; a file, then decide that in fact you don&#x2019;t want Mercurial to track it, use <a 
 id="dx13-177005"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; to undo the add.
Don&#x2019;t worry; Mercurial will not modify the file in any way. It will just &#x201C;unmark&#x201D; the file.
                                                                                         
                                                                                         
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-177007r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;oops</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;oops</span>
<br class="fancyvrb" /><a 
 id="x13-177009r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;add</span><span 
class="pcrb7t-">&#x00A0;oops</span>
<br class="fancyvrb" /><a 
 id="x13-177011r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span><span 
class="pcrb7t-">&#x00A0;oops</span>
<br class="fancyvrb" /><a 
 id="x13-177013r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;A</span><span 
class="pcrr7tn-">&#x00A0;oops</span>
<br class="fancyvrb" /><a 
 id="x13-177015r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;revert</span><span 
class="pcrb7t-">&#x00A0;oops</span>
<br class="fancyvrb" /><a 
 id="x13-177017r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-177019r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;?</span><span 
class="pcrr7tn-">&#x00A0;oops</span>
   </div>
<!--l. 167--><p class="indent" >   Similarly, if you ask Mercurial to <a 
 id="dx13-177020"></a>&#x201C;<span 
class="pcrr7tn-">hg remove</span>&#x201D; a file, you can use <a 
 id="dx13-177021"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; to restore it to the contents it had as of the
parent of the working directory.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-177023r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;remove</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-177025r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-177027r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;R</span><span 
class="pcrr7tn-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-177029r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;revert</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-177031r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-177033r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">ls</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-177035r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;file</span>
   </div>
<!--l. 171--><p class="noindent" >This works just as well for a file that you deleted by hand, without telling Mercurial (recall that in Mercurial terminology, this kind
of file is called &#x201C;missing&#x201D;).
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-177037r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">rm</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-177039r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-177041r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;!</span><span 
class="pcrr7tn-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-177043r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;revert</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-177045r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">ls</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-177047r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;file</span>
   </div>
<!--l. 176--><p class="indent" >   If you revert a <a 
 id="dx13-177048"></a>&#x201C;<span 
class="pcrr7tn-">hg copy</span>&#x201D;, the copied-to file remains in your working directory afterwards, untracked. Since a copy doesn&#x2019;t
affect the copied-from file in any way, Mercurial doesn&#x2019;t do anything with the copied-from file.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-177050r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;copy</span><span 
class="pcrb7t-">&#x00A0;file</span><span 
class="pcrb7t-">&#x00A0;new-file</span>
<br class="fancyvrb" /><a 
 id="x13-177052r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;revert</span><span 
class="pcrb7t-">&#x00A0;new-file</span>
<br class="fancyvrb" /><a 
 id="x13-177054r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-177056r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;?</span><span 
class="pcrr7tn-">&#x00A0;new-file</span>
   </div>
<!--l. 182--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x13-1780009.2.1"></a>A slightly special case: reverting a rename</h5>
<!--l. 184--><p class="noindent" >If you <a 
 id="dx13-178001"></a>&#x201C;<span 
class="pcrr7tn-">hg rename</span>&#x201D; a file, there is one small detail that you should remember. When you <a 
 id="dx13-178002"></a>&#x201C;<span 
class="pcrr7tn-">hg revert</span>&#x201D; a rename, it&#x2019;s not
enough to provide the name of the renamed-to file, as you can see here.
                                                                                         
                                                                                         
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-178004r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;rename</span><span 
class="pcrb7t-">&#x00A0;file</span><span 
class="pcrb7t-">&#x00A0;new-file</span>
<br class="fancyvrb" /><a 
 id="x13-178006r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;revert</span><span 
class="pcrb7t-">&#x00A0;new-file</span>
<br class="fancyvrb" /><a 
 id="x13-178008r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-178010r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;?</span><span 
class="pcrr7tn-">&#x00A0;new-file</span>
   </div>
<!--l. 189--><p class="noindent" >As you can see from the output of <a 
 id="dx13-178011"></a>&#x201C;<span 
class="pcrr7tn-">hg status</span>&#x201D;, the renamed-to file is no longer identified as added, but the renamed-<span 
class="ptmri7t-">from </span>file is
still removed! This is counter-intuitive (at least to me), but at least it&#x2019;s easy to deal with.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-178013r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;revert</span><span 
class="pcrb7t-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-178015r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;no</span><span 
class="pcrr7tn-">&#x00A0;changes</span><span 
class="pcrr7tn-">&#x00A0;needed</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;file</span>
<br class="fancyvrb" /><a 
 id="x13-178017r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;status</span>
<br class="fancyvrb" /><a 
 id="x13-178019r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;?</span><span 
class="pcrr7tn-">&#x00A0;new-file</span>
   </div>
<!--l. 194--><p class="noindent" >So remember, to revert a <a 
 id="dx13-178020"></a>&#x201C;<span 
class="pcrr7tn-">hg rename</span>&#x201D;, you must provide <span 
class="ptmri7t-">both </span>the source and destination names.
</p><!--l. 197--><p class="indent" >   (By the way, if you rename a file, then modify the renamed-to file, then revert both components of the rename, when
Mercurial restores the file that was removed as part of the rename, it will be unmodified. If you need the modifications in the
renamed-to file to show up in the renamed-from file, don&#x2019;t forget to copy them over.)
</p><!--l. 203--><p class="indent" >   These fiddly aspects of reverting a rename arguably constitute a small bug in Mercurial.
</p><!--l. 206--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">9.3    </span> <a 
 id="x13-1790009.3"></a>Dealing with committed changes</h3>
<!--l. 208--><p class="noindent" >Consider a case where you have committed a change <span 
class="zptmcmrm-">a</span>, and another change <span 
class="zptmcmrm-">b </span>on top of it; you then realise that change <span 
class="zptmcmrm-">a </span>was
incorrect. Mercurial lets you &#x201C;back out&#x201D; an entire changeset automatically, and building blocks that let you reverse part of a
changeset by hand.
</p><!--l. 214--><p class="indent" >   Before you read this section, here&#x2019;s something to keep in mind: the <a 
 id="dx13-179001"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command undoes changes by <span 
class="ptmri7t-">adding</span>
history, not by modifying or erasing it. It&#x2019;s the right tool to use if you&#x2019;re fixing bugs, but not if you&#x2019;re trying to undo some
change that has catastrophic consequences. To deal with those, see section&#x00A0;<a 
href="#x13-1860009.4">9.4<!--tex4ht:ref: sec:undo:aaaiiieee --></a>.
</p><!--l. 221--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.3.1    </span> <a 
 id="x13-1800009.3.1"></a>Backing out a changeset</h4>
<!--l. 223--><p class="noindent" >The <a 
 id="dx13-180001"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command lets you &#x201C;undo&#x201D; the effects of an entire changeset in an automated fashion. Because Mercurial&#x2019;s
history is immutable, this command <span 
class="ptmri7t-">does not </span>get rid of the changeset you want to undo. Instead, it creates a new changeset that
<span 
class="ptmri7t-">reverses </span>the effect of the to-be-undone changeset.
</p><!--l. 229--><p class="indent" >   The operation of the <a 
 id="dx13-180002"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command is a little intricate, so let&#x2019;s illustrate it with some examples. First, we&#x2019;ll create
a repository with some simple changes.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-180004r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;init</span><span 
class="pcrb7t-">&#x00A0;myrepo</span>
<br class="fancyvrb" /><a 
 id="x13-180006r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;myrepo</span>
<br class="fancyvrb" /><a 
 id="x13-180008r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;first</span><span 
class="pcrb7t-">&#x00A0;change</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-180010r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;add</span><span 
class="pcrb7t-">&#x00A0;myfile</span>
                                                                                         
                                                                                         
<br class="fancyvrb" /><a 
 id="x13-180012r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'first</span><span 
class="pcrb7t-">&#x00A0;change'</span>
<br class="fancyvrb" /><a 
 id="x13-180014r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;second</span><span 
class="pcrb7t-">&#x00A0;change</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-180016r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'second</span><span 
class="pcrb7t-">&#x00A0;change'</span>
   </div>
<!--l. 234--><p class="indent" >   The <a 
 id="dx13-180017"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command takes a single changeset ID as its argument; this is the changeset to back out.
Normally, <a 
 id="dx13-180018"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; will drop you into a text editor to write a commit message, so you can record why
you&#x2019;re backing the change out. In this example, we provide a commit message on the command line using the <a 
 id="dx13-180019"></a><span 
class="pcrr7tn-">-m</span>
option.
</p><!--l. 241--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.3.2    </span> <a 
 id="x13-1810009.3.2"></a>Backing out the tip changeset</h4>
<!--l. 243--><p class="noindent" >We&#x2019;re going to start by backing out the last changeset we committed.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-181002r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;backout</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'back</span><span 
class="pcrb7t-">&#x00A0;out</span><span 
class="pcrb7t-">&#x00A0;second</span><span 
class="pcrb7t-">&#x00A0;change'</span><span 
class="pcrb7t-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x13-181004r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;reverting</span><span 
class="pcrr7tn-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-181006r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;2:e02eba531f95</span><span 
class="pcrr7tn-">&#x00A0;backs</span><span 
class="pcrr7tn-">&#x00A0;out</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;1:c3e45317eb42</span>
<br class="fancyvrb" /><a 
 id="x13-181008r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-181010r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first</span><span 
class="pcrr7tn-">&#x00A0;change</span>
   </div>
<!--l. 245--><p class="noindent" >You can see that the second line from <span 
class="pcrr7tn-">myfile </span>is no longer present. Taking a look at the output of <a 
 id="dx13-181011"></a>&#x201C;<span 
class="pcrr7tn-">hg log</span>&#x201D; gives us an idea of what
the <a 
 id="dx13-181012"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command has done.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-181014r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;log</span><span 
class="pcrb7t-">&#x00A0;--style</span><span 
class="pcrb7t-">&#x00A0;compact</span>
<br class="fancyvrb" /><a 
 id="x13-181016r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2[tip]</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;e02eba531f95</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2007-12-10</span><span 
class="pcrr7tn-">&#x00A0;19:53</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x13-181018r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;back</span><span 
class="pcrr7tn-">&#x00A0;out</span><span 
class="pcrr7tn-">&#x00A0;second</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-181020r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-181022r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;c3e45317eb42</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2007-12-10</span><span 
class="pcrr7tn-">&#x00A0;19:53</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x13-181024r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;second</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-181026r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-181028r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;f3db226c9812</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2007-12-10</span><span 
class="pcrr7tn-">&#x00A0;19:53</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x13-181030r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-181032r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
   </div>
<!--l. 249--><p class="noindent" >Notice that the new changeset that <a 
 id="dx13-181033"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; has created is a child of the changeset we backed out. It&#x2019;s easier to see this
in figure&#x00A0;<a 
href="#x13-1810341">9.1<!--tex4ht:ref: fig:undo:backout --></a>, which presents a graphical view of the change history. As you can see, the history is nice and
linear.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x13-1810341"></a>
                                                                                         
                                                                                         
<!--l. 256--><p class="noindent" ><img 
src="undo-simple.png" alt="PIC"  
 />
<br /> </p><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;9.1: </td><td  
class="content">Backing out a change using the <a 
 id="dx13-181035"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command</td></tr></table><!--tex4ht:label?: x13-1810341 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">9.3.3    </span> <a 
 id="x13-1820009.3.3"></a>Backing out a non-tip change</h4>
<!--l. 263--><p class="noindent" >If you want to back out a change other than the last one you committed, pass the <a 
 id="dx13-182001"></a><span 
class="pcrr7tn-">--merge </span>option to the <a 
 id="dx13-182002"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D;
command.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-182004r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;..</span>
<br class="fancyvrb" /><a 
 id="x13-182006r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;clone</span><span 
class="pcrb7t-">&#x00A0;-r1</span><span 
class="pcrb7t-">&#x00A0;myrepo</span><span 
class="pcrb7t-">&#x00A0;non-tip-repo</span>
<br class="fancyvrb" /><a 
 id="x13-182008r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;requesting</span><span 
class="pcrr7tn-">&#x00A0;all</span><span 
class="pcrr7tn-">&#x00A0;changes</span>
<br class="fancyvrb" /><a 
 id="x13-182010r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;changesets</span>
<br class="fancyvrb" /><a 
 id="x13-182012r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;manifests</span>
<br class="fancyvrb" /><a 
 id="x13-182014r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;file</span><span 
class="pcrr7tn-">&#x00A0;changes</span>
<br class="fancyvrb" /><a 
 id="x13-182016r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;added</span><span 
class="pcrr7tn-">&#x00A0;2</span><span 
class="pcrr7tn-">&#x00A0;changesets</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;2</span><span 
class="pcrr7tn-">&#x00A0;changes</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;files</span>
<br class="fancyvrb" /><a 
 id="x13-182018r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
<br class="fancyvrb" /><a 
 id="x13-182020r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;non-tip-repo</span>
   </div>
<!--l. 267--><p class="noindent" >This makes backing out any changeset a &#x201C;one-shot&#x201D; operation that&#x2019;s usually simple and fast.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-182022r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;third</span><span 
class="pcrb7t-">&#x00A0;change</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-182024r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'third</span><span 
class="pcrb7t-">&#x00A0;change'</span>
<br class="fancyvrb" /><a 
 id="x13-182026r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;backout</span><span 
class="pcrb7t-">&#x00A0;--merge</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'back</span><span 
class="pcrb7t-">&#x00A0;out</span><span 
class="pcrb7t-">&#x00A0;second</span><span 
class="pcrb7t-">&#x00A0;change'</span><span 
class="pcrb7t-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x13-182028r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;reverting</span><span 
class="pcrr7tn-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-182030r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;3:dc2f0a481aab</span><span 
class="pcrr7tn-">&#x00A0;backs</span><span 
class="pcrr7tn-">&#x00A0;out</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;1:c3e45317eb42</span>
<br class="fancyvrb" /><a 
 id="x13-182032r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;merging</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;2:6beeebc9c7f6</span>
<br class="fancyvrb" /><a 
 id="x13-182034r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;merging</span><span 
class="pcrr7tn-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-182036r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
<br class="fancyvrb" /><a 
 id="x13-182038r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;(branch</span><span 
class="pcrr7tn-">&#x00A0;merge,</span><span 
class="pcrr7tn-">&#x00A0;don't</span><span 
class="pcrr7tn-">&#x00A0;forget</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;commit)</span>
   </div>
<!--l. 271--><p class="indent" >   If you take a look at the contents of <span 
class="pcrr7tn-">myfile </span>after the backout finishes, you&#x2019;ll see that the first and third changes are present,
but not the second.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-182040r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-182042r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-182044r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;third</span><span 
class="pcrr7tn-">&#x00A0;change</span>
   </div>
<!--l. 276--><p class="indent" >   As the graphical history in figure&#x00A0;<a 
href="#x13-1820452">9.2<!--tex4ht:ref: fig:undo:backout-non-tip --></a> illustrates, Mercurial actually commits <span 
class="ptmri7t-">two </span>changes in this kind of situation (the
box-shaped nodes are the ones that Mercurial commits automatically). Before Mercurial begins the backout process, it first
remembers what the current parent of the working directory is. It then backs out the target changeset, and commits that as a
changeset. Finally, it merges back to the previous parent of the working directory, and commits the result of the
merge.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x13-1820452"></a>
                                                                                         
                                                                                         
<!--l. 287--><p class="noindent" ><img 
src="undo-non-tip.png" alt="PIC"  
 />
<br /> </p><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;9.2: </td><td  
class="content">Automated backout of a non-tip change using the <a 
 id="dx13-182046"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command</td></tr></table><!--tex4ht:label?: x13-1820452 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 292--><p class="indent" >   The result is that you end up &#x201C;back where you were&#x201D;, only with some extra history that undoes the effect of the changeset
you wanted to back out.
</p>
   <h5 class="subsubsectionHead"><a 
 id="x13-1830009.3.3"></a>Always use the <span 
class="pcrr7tn-">--merge </span>option</h5>
<!--l. 298--><p class="noindent" >In fact, since the <a 
 id="dx13-183001"></a><span 
class="pcrr7tn-">--merge </span>option will do the &#x201C;right thing&#x201D; whether or not the changeset you&#x2019;re backing out is the tip (i.e.&#x00A0;it
won&#x2019;t try to merge if it&#x2019;s backing out the tip, since there&#x2019;s no need), you should <span 
class="ptmri7t-">always </span>use this option when you run the <a 
 id="dx13-183002"></a>&#x201C;<span 
class="pcrr7tn-">hg</span>
<span 
class="pcrr7tn-">backout</span>&#x201D; command.
</p><!--l. 304--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.3.4    </span> <a 
 id="x13-1840009.3.4"></a>Gaining more control of the backout process</h4>
<!--l. 306--><p class="noindent" >While I&#x2019;ve recommended that you always use the <a 
 id="dx13-184001"></a><span 
class="pcrr7tn-">--merge </span>option when backing out a change, the <a 
 id="dx13-184002"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D;
command lets you decide how to merge a backout changeset. Taking control of the backout process by hand is
something you will rarely need to do, but it can be useful to understand what the <a 
 id="dx13-184003"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command is
doing for you automatically. To illustrate this, let&#x2019;s clone our first repository, but omit the backout change that it
contains.
</p><!--l. 315--><p class="indent" >
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-184005r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;..</span>
<br class="fancyvrb" /><a 
 id="x13-184007r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;clone</span><span 
class="pcrb7t-">&#x00A0;-r1</span><span 
class="pcrb7t-">&#x00A0;myrepo</span><span 
class="pcrb7t-">&#x00A0;newrepo</span>
<br class="fancyvrb" /><a 
 id="x13-184009r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;requesting</span><span 
class="pcrr7tn-">&#x00A0;all</span><span 
class="pcrr7tn-">&#x00A0;changes</span>
<br class="fancyvrb" /><a 
 id="x13-184011r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;changesets</span>
<br class="fancyvrb" /><a 
 id="x13-184013r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;manifests</span>
<br class="fancyvrb" /><a 
 id="x13-184015r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;adding</span><span 
class="pcrr7tn-">&#x00A0;file</span><span 
class="pcrr7tn-">&#x00A0;changes</span>
<br class="fancyvrb" /><a 
 id="x13-184017r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;added</span><span 
class="pcrr7tn-">&#x00A0;2</span><span 
class="pcrr7tn-">&#x00A0;changesets</span><span 
class="pcrr7tn-">&#x00A0;with</span><span 
class="pcrr7tn-">&#x00A0;2</span><span 
class="pcrr7tn-">&#x00A0;changes</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;files</span>
<br class="fancyvrb" /><a 
 id="x13-184019r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
<br class="fancyvrb" /><a 
 id="x13-184021r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;newrepo</span>
   </div>
<!--l. 316--><p class="noindent" >As with our earlier example, We&#x2019;ll commit a third changeset, then back out its parent, and see what happens.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-184023r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;third</span><span 
class="pcrb7t-">&#x00A0;change</span><span 
class="pcrb7t-">&#x00A0;&#x003e;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-184025r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'third</span><span 
class="pcrb7t-">&#x00A0;change'</span>
<br class="fancyvrb" /><a 
 id="x13-184027r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;backout</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'back</span><span 
class="pcrb7t-">&#x00A0;out</span><span 
class="pcrb7t-">&#x00A0;second</span><span 
class="pcrb7t-">&#x00A0;change'</span><span 
class="pcrb7t-">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x13-184029r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;reverting</span><span 
class="pcrr7tn-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-184031r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;3:dc2f0a481aab</span><span 
class="pcrr7tn-">&#x00A0;backs</span><span 
class="pcrr7tn-">&#x00A0;out</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;1:c3e45317eb42</span>
<br class="fancyvrb" /><a 
 id="x13-184033r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;backout</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;is</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;new</span><span 
class="pcrr7tn-">&#x00A0;head</span><span 
class="pcrr7tn-">&#x00A0;-</span><span 
class="pcrr7tn-">&#x00A0;do</span><span 
class="pcrr7tn-">&#x00A0;not</span><span 
class="pcrr7tn-">&#x00A0;forget</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;merge</span>
<br class="fancyvrb" /><a 
 id="x13-184035r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;(use</span><span 
class="pcrr7tn-">&#x00A0;"backout</span><span 
class="pcrr7tn-">&#x00A0;--merge"</span><span 
class="pcrr7tn-">&#x00A0;if</span><span 
class="pcrr7tn-">&#x00A0;you</span><span 
class="pcrr7tn-">&#x00A0;want</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;auto-merge)</span>
   </div>
<!--l. 319--><p class="noindent" >Our new changeset is again a descendant of the changeset we backout out; it&#x2019;s thus a new head, <span 
class="ptmri7t-">not </span>a descendant of the changeset
that was the tip. The <a 
 id="dx13-184036"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command was quite explicit in telling us this.
</p>
   <div class="fancyvrb" id="fancyvrb">
                                                                                         
                                                                                         
<a 
 id="x13-184038r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;log</span><span 
class="pcrb7t-">&#x00A0;--style</span><span 
class="pcrb7t-">&#x00A0;compact</span>
<br class="fancyvrb" /><a 
 id="x13-184040r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;3[tip]:1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;dc2f0a481aab</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2007-12-10</span><span 
class="pcrr7tn-">&#x00A0;19:53</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x13-184042r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;back</span><span 
class="pcrr7tn-">&#x00A0;out</span><span 
class="pcrr7tn-">&#x00A0;second</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-184044r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-184046r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;6beeebc9c7f6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2007-12-10</span><span 
class="pcrr7tn-">&#x00A0;19:53</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x13-184048r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;third</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-184050r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-184052r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;c3e45317eb42</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2007-12-10</span><span 
class="pcrr7tn-">&#x00A0;19:53</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x13-184054r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;second</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-184056r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-184058r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;f3db226c9812</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2007-12-10</span><span 
class="pcrr7tn-">&#x00A0;19:53</span><span 
class="pcrr7tn-">&#x00A0;+0000</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bos</span>
<br class="fancyvrb" /><a 
 id="x13-184060r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-184062r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
   </div>
<!--l. 325--><p class="indent" >   Again, it&#x2019;s easier to see what has happened by looking at a graph of the revision history, in figure&#x00A0;<a 
href="#x13-1840643">9.3<!--tex4ht:ref: fig:undo:backout-manual --></a>. This makes it clear
that when we use <a 
 id="dx13-184063"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; to back out a change other than the tip, Mercurial adds a new head to the repository (the
change it committed is box-shaped).
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x13-1840643"></a>
                                                                                         
                                                                                         
<!--l. 333--><p class="noindent" ><img 
src="undo-manual.png" alt="PIC"  
 />
<br /> </p><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;9.3: </td><td  
class="content">Backing out a change using the <a 
 id="dx13-184065"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command</td></tr></table><!--tex4ht:label?: x13-1840643 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
<!--l. 338--><p class="indent" >   After the <a 
 id="dx13-184066"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command has completed, it leaves the new &#x201C;backout&#x201D; changeset as the parent of the working
directory.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-184068r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;parents</span>
<br class="fancyvrb" /><a 
 id="x13-184070r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;3:dc2f0a481aab</span>
<br class="fancyvrb" /><a 
 id="x13-184072r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x13-184074r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;parent:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1:c3e45317eb42</span>
<br class="fancyvrb" /><a 
 id="x13-184076r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x13-184078r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Mon</span><span 
class="pcrr7tn-">&#x00A0;Dec</span><span 
class="pcrr7tn-">&#x00A0;10</span><span 
class="pcrr7tn-">&#x00A0;19:53:16</span><span 
class="pcrr7tn-">&#x00A0;2007</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x13-184080r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;back</span><span 
class="pcrr7tn-">&#x00A0;out</span><span 
class="pcrr7tn-">&#x00A0;second</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-184082r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
   </div>
<!--l. 341--><p class="noindent" >Now we have two isolated sets of changes.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-184084r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;heads</span>
<br class="fancyvrb" /><a 
 id="x13-184086r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;3:dc2f0a481aab</span>
<br class="fancyvrb" /><a 
 id="x13-184088r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tag:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;tip</span>
<br class="fancyvrb" /><a 
 id="x13-184090r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;parent:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1:c3e45317eb42</span>
<br class="fancyvrb" /><a 
 id="x13-184092r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x13-184094r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Mon</span><span 
class="pcrr7tn-">&#x00A0;Dec</span><span 
class="pcrr7tn-">&#x00A0;10</span><span 
class="pcrr7tn-">&#x00A0;19:53:16</span><span 
class="pcrr7tn-">&#x00A0;2007</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x13-184096r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;back</span><span 
class="pcrr7tn-">&#x00A0;out</span><span 
class="pcrr7tn-">&#x00A0;second</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-184098r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-184100r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;2:6beeebc9c7f6</span>
<br class="fancyvrb" /><a 
 id="x13-184102r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x13-184104r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Mon</span><span 
class="pcrr7tn-">&#x00A0;Dec</span><span 
class="pcrr7tn-">&#x00A0;10</span><span 
class="pcrr7tn-">&#x00A0;19:53:16</span><span 
class="pcrr7tn-">&#x00A0;2007</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x13-184106r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;third</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-184108r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
   </div>
<!--l. 344--><p class="indent" >   Let&#x2019;s think about what we expect to see as the contents of <span 
class="pcrr7tn-">myfile </span>now. The first change should be present, because
we&#x2019;ve never backed it out. The second change should be missing, as that&#x2019;s the change we backed out. Since
the history graph shows the third change as a separate head, we <span 
class="ptmri7t-">don&#x2019;t </span>expect to see the third change present in
<span 
class="pcrr7tn-">myfile</span>.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-184110r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-184112r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first</span><span 
class="pcrr7tn-">&#x00A0;change</span>
   </div>
<!--l. 351--><p class="noindent" >To get the third change back into the file, we just do a normal merge of our two heads.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-184114r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;merge</span>
<br class="fancyvrb" /><a 
 id="x13-184116r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;merging</span><span 
class="pcrr7tn-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-184118r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
<br class="fancyvrb" /><a 
 id="x13-184120r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;(branch</span><span 
class="pcrr7tn-">&#x00A0;merge,</span><span 
class="pcrr7tn-">&#x00A0;don't</span><span 
class="pcrr7tn-">&#x00A0;forget</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;commit)</span>
<br class="fancyvrb" /><a 
 id="x13-184122r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'merged</span><span 
class="pcrb7t-">&#x00A0;backout</span><span 
class="pcrb7t-">&#x00A0;with</span><span 
class="pcrb7t-">&#x00A0;previous</span><span 
class="pcrb7t-">&#x00A0;tip'</span>
                                                                                         
                                                                                         
<br class="fancyvrb" /><a 
 id="x13-184124r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cat</span><span 
class="pcrb7t-">&#x00A0;myfile</span>
<br class="fancyvrb" /><a 
 id="x13-184126r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;first</span><span 
class="pcrr7tn-">&#x00A0;change</span>
<br class="fancyvrb" /><a 
 id="x13-184128r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;third</span><span 
class="pcrr7tn-">&#x00A0;change</span>
   </div>
<!--l. 354--><p class="noindent" >Afterwards, the graphical history of our repository looks like figure&#x00A0;<a 
href="#x13-1841294">9.4<!--tex4ht:ref: fig:undo:backout-manual-merge --></a>.
</p>
   <hr class="figure" /><div class="figure" 
><table class="figure"><tr class="figure"><td class="figure" 
>
                                                                                         
                                                                                         
<a 
 id="x13-1841294"></a>
                                                                                         
                                                                                         
<!--l. 359--><p class="noindent" ><img 
src="undo-manual-merge.png" alt="PIC"  
 />
<br /> </p><table class="caption" 
><tr style="vertical-align:baseline;" class="caption"><td class="id">Figure&#x00A0;9.4: </td><td  
class="content">Manually merging a backout change</td></tr></table><!--tex4ht:label?: x13-1841294 -->
                                                                                         
                                                                                         
   </td></tr></table></div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">9.3.5    </span> <a 
 id="x13-1850009.3.5"></a>Why &#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; works as it does</h4>
<!--l. 366--><p class="noindent" >Here&#x2019;s a brief description of how the <a 
 id="dx13-185001"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command works.
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x13-185003x1">It ensures that the working directory is &#x201C;clean&#x201D;, i.e.&#x00A0;that the output of <a 
 id="dx13-185004"></a>&#x201C;<span 
class="pcrr7tn-">hg status</span>&#x201D; would be empty.
     </li>
     <li 
  class="enumerate" id="x13-185006x2">It remembers the current parent of the working directory. Let&#x2019;s call this changeset <span 
class="pcrr7tn-">orig</span>
     </li>
     <li 
  class="enumerate" id="x13-185008x3">It does the equivalent of a <a 
 id="dx13-185009"></a>&#x201C;<span 
class="pcrr7tn-">hg update</span>&#x201D; to sync the working directory to the changeset you want to back out.
     Let&#x2019;s call this changeset <span 
class="pcrr7tn-">backout</span>
     </li>
     <li 
  class="enumerate" id="x13-185011x4">It finds the parent of that changeset. Let&#x2019;s call that changeset <span 
class="pcrr7tn-">parent</span>.
     </li>
     <li 
  class="enumerate" id="x13-185013x5">For each file that the <span 
class="pcrr7tn-">backout </span>changeset affected, it does the equivalent of a <a 
 id="dx13-185014"></a>&#x201C;<span 
class="pcrr7tn-">hg revert -r parent</span>&#x201D; on that
     file, to restore it to the contents it had before that changeset was committed.
     </li>
     <li 
  class="enumerate" id="x13-185016x6">It commits the result as a new changeset. This changeset has <span 
class="pcrr7tn-">backout </span>as its parent.
     </li>
     <li 
  class="enumerate" id="x13-185018x7">If you specify <a 
 id="dx13-185019"></a><span 
class="pcrr7tn-">--merge </span>on the command line, it merges with <span 
class="pcrr7tn-">orig</span>, and commits the result of the merge.</li></ol>
<!--l. 387--><p class="indent" >   An alternative way to implement the <a 
 id="dx13-185020"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command would be to <a 
 id="dx13-185021"></a>&#x201C;<span 
class="pcrr7tn-">hg export</span>&#x201D; the to-be-backed-out changeset as
a diff, then use the <a 
 id="dx13-185022"></a><span 
class="pcrr7tn-">--reverse </span>option to the <a 
 id="dx13-185023"></a><span 
class="pcrr7tn-">patch </span>command to reverse the effect of the change without fiddling with the
working directory. This sounds much simpler, but it would not work nearly as well.
</p><!--l. 394--><p class="indent" >   The reason that <a 
 id="dx13-185024"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; does an update, a commit, a merge, and another commit is to give the merge machinery the
best chance to do a good job when dealing with all the changes <span 
class="ptmri7t-">between </span>the change you&#x2019;re backing out and the current
tip.
</p><!--l. 399--><p class="indent" >   If you&#x2019;re backing out a changeset that&#x2019;s&#x00A0;100 revisions back in your project&#x2019;s history, the chances that the <a 
 id="dx13-185025"></a><span 
class="pcrr7tn-">patch</span>
command will be able to apply a reverse diff cleanly are not good, because intervening changes are likely to have
&#x201C;broken the context&#x201D; that <a 
 id="dx13-185026"></a><span 
class="pcrr7tn-">patch </span>uses to determine whether it can apply a patch (if this sounds like gibberish,
see <a 
href="hgbookch12.html#x16-27300012.4">12.4<!--tex4ht:ref: sec:mq:patch --></a> for a discussion of the <a 
 id="dx13-185027"></a><span 
class="pcrr7tn-">patch </span>command). Also, Mercurial&#x2019;s merge machinery will handle files and
directories being renamed, permission changes, and modifications to binary files, none of which <a 
 id="dx13-185028"></a><span 
class="pcrr7tn-">patch </span>can deal
with.
</p><!--l. 410--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">9.4    </span> <a 
 id="x13-1860009.4"></a>Changes that should never have been</h3>
<!--l. 413--><p class="noindent" >Most of the time, the <a 
 id="dx13-186001"></a>&#x201C;<span 
class="pcrr7tn-">hg backout</span>&#x201D; command is exactly what you need if you want to undo the effects of a change. It leaves a
permanent record of exactly what you did, both when committing the original changeset and when you cleaned up after
it.
</p><!--l. 418--><p class="indent" >   On rare occasions, though, you may find that you&#x2019;ve committed a change that really should not be present in the repository
at all. For example, it would be very unusual, and usually considered a mistake, to commit a software project&#x2019;s object files as
well as its source files. Object files have almost no intrinsic value, and they&#x2019;re <span 
class="ptmri7t-">big</span>, so they increase the size of the repository and
the amount of time it takes to clone or pull changes.
                                                                                         
                                                                                         
</p><!--l. 426--><p class="indent" >   Before I discuss the options that you have if you commit a &#x201C;brown paper bag&#x201D; change (the kind that&#x2019;s so bad that
you want to pull a brown paper bag over your head), let me first discuss some approaches that probably won&#x2019;t
work.
</p><!--l. 431--><p class="indent" >   Since Mercurial treats history as accumulative&#x2014;every change builds on top of all changes that preceded it&#x2014;you generally
can&#x2019;t just make disastrous changes disappear. The one exception is when you&#x2019;ve just committed a change, and it hasn&#x2019;t been
pushed or pulled into another repository. That&#x2019;s when you can safely use the <a 
 id="dx13-186002"></a>&#x201C;<span 
class="pcrr7tn-">hg rollback</span>&#x201D; command, as I detailed in
section&#x00A0;<a 
href="#x13-1720009.1.2">9.1.2<!--tex4ht:ref: sec:undo:rollback --></a>.
</p><!--l. 438--><p class="indent" >   After you&#x2019;ve pushed a bad change to another repository, you <span 
class="ptmri7t-">could </span>still use <a 
 id="dx13-186003"></a>&#x201C;<span 
class="pcrr7tn-">hg rollback</span>&#x201D; to make your local copy of the
change disappear, but it won&#x2019;t have the consequences you want. The change will still be present in the remote repository, so it
will reappear in your local repository the next time you pull.
</p><!--l. 444--><p class="indent" >   If a situation like this arises, and you know which repositories your bad change has propagated into, you can <span 
class="ptmri7t-">try </span>to get
rid of the changeefrom <span 
class="ptmri7t-">every </span>one of those repositories. This is, of course, not a satisfactory solution: if you
miss even a single repository while you&#x2019;re expunging, the change is still &#x201C;in the wild&#x201D;, and could propagate
further.
</p><!--l. 451--><p class="indent" >   If you&#x2019;ve committed one or more changes <span 
class="ptmri7t-">after </span>the change that you&#x2019;d like to see disappear, your options are further reduced.
Mercurial doesn&#x2019;t provide a way to &#x201C;punch a hole&#x201D; in history, leaving changesets intact.
</p><!--l. 456--><p class="indent" >   XXX This needs filling out. The <span 
class="pcrr7tn-">hg-replay </span>script in the <span 
class="pcrr7tn-">examples </span>directory works, but doesn&#x2019;t handle merge changesets.
Kind of an important omission.
</p><!--l. 460--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.4.1    </span> <a 
 id="x13-1870009.4.1"></a>Protect yourself from &#x201C;escaped&#x201D; changes</h4>
<!--l. 462--><p class="noindent" >If you&#x2019;ve committed some changes to your local repository and they&#x2019;ve been pushed or pulled somewhere else, this isn&#x2019;t
necessarily a disaster. You can protect yourself ahead of time against some classes of bad changeset. This is particularly easy if
your team usually pulls changes from a central repository.
</p><!--l. 468--><p class="indent" >   By configuring some hooks on that repository to validate incoming changesets (see chapter&#x00A0;<a 
href="hgbookch10.html#x14-19700010">10<!--tex4ht:ref: chap:hook --></a>), you can automatically
prevent some kinds of bad changeset from being pushed to the central repository at all. With such a configuration in place,
some kinds of bad changeset will naturally tend to &#x201C;die out&#x201D; because they can&#x2019;t propagate into the central repository. Better yet,
this happens without any need for explicit intervention.
</p><!--l. 476--><p class="indent" >   For instance, an incoming change hook that verifies that a changeset will actually compile can prevent people from
inadvertantly &#x201C;breaking the build&#x201D;.
</p><!--l. 480--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">9.5    </span> <a 
 id="x13-1880009.5"></a>Finding the source of a bug</h3>
<!--l. 483--><p class="noindent" >While it&#x2019;s all very well to be able to back out a changeset that introduced a bug, this requires that you know which changeset to
back out. Mercurial provides an invaluable extension, called <a 
 id="dx13-188001"></a><span 
class="pcrr7tn-">bisect</span>, that helps you to automate this process and accomplish it
very efficiently.
</p><!--l. 489--><p class="indent" >   The idea behind the <a 
 id="dx13-188002"></a><span 
class="pcrr7tn-">bisect </span>extension is that a changeset has introduced some change of behaviour that you can identify
with a simple binary test. You don&#x2019;t know which piece of code introduced the change, but you know how to test for the
presence of the bug. The <a 
 id="dx13-188003"></a><span 
class="pcrr7tn-">bisect </span>extension uses your test to direct its search for the changeset that introduced the code that
caused the bug.
</p><!--l. 496--><p class="indent" >   Here are a few scenarios to help you understand how you might apply this extension. </p>
     <ul><li><span class="dt">
     </span><span class="dd">The most recent version of your software has a bug that you remember wasn&#x2019;t present a few weeks ago, but you
     don&#x2019;t know when it was introduced. Here, your binary test checks for the presence of that bug.
                                                                                         
                                                                                         
     </span><li><span class="dt">
     </span><span class="dd">You fixed a bug in a rush, and now it&#x2019;s time to close the entry in your team&#x2019;s bug database. The bug database
     requires a changeset ID when you close an entry, but you don&#x2019;t remember which changeset you fixed the bug in.
     Once again, your binary test checks for the presence of the bug.
     </span><li><span class="dt">
     </span><span class="dd">Your software works correctly, but runs&#x00A0;15% slower than the last time you measured it. You want to know which
     changeset introduced the performance regression. In this case, your binary test measures the performance of
     your software, to see whether it&#x2019;s &#x201C;fast&#x201D; or &#x201C;slow&#x201D;.
     </span><li><span class="dt">
     </span><span class="dd">The sizes of the components of your project that you ship exploded recently, and you suspect that something
     changed in the way you build your project.</li></ul>
<!--l. 518--><p class="indent" >   From these examples, it should be clear that the <a 
 id="dx13-188004"></a><span 
class="pcrr7tn-">bisect </span>extension is not useful only for finding the sources of bugs. You
can use it to find any &#x201C;emergent property&#x201D; of a repository (anything that you can&#x2019;t find from a simple text search of the files in
the tree) for which you can write a binary test.
</p><!--l. 524--><p class="indent" >   We&#x2019;ll introduce a little bit of terminology here, just to make it clear which parts of the search process are your
responsibility, and which are Mercurial&#x2019;s. A <span 
class="ptmri7t-">test </span>is something that <span 
class="ptmri7t-">you </span>run when <a 
 id="dx13-188005"></a><span 
class="pcrr7tn-">bisect </span>chooses a changeset. A <span 
class="ptmri7t-">probe </span>is what
<a 
 id="dx13-188006"></a><span 
class="pcrr7tn-">bisect </span>runs to tell whether a revision is good. Finally, we&#x2019;ll use the word &#x201C;bisect&#x201D;, as both a noun and a verb, to stand in for the
phrase &#x201C;search using the <a 
 id="dx13-188007"></a><span 
class="pcrr7tn-">bisect </span>extension&#x201D;.
</p><!--l. 532--><p class="indent" >   One simple way to automate the searching process would be simply to probe every changeset. However, this scales poorly.
If it took ten minutes to test a single changeset, and you had 10,000 changesets in your repository, the exhaustive approach
would take on average&#x00A0;35 <span 
class="ptmri7t-">days </span>to find the changeset that introduced a bug. Even if you knew that the bug was introduced by
one of the last 500 changesets, and limited your search to those, you&#x2019;d still be looking at over 40 hours to find the changeset that
introduced your bug.
</p><!--l. 541--><p class="indent" >   What the <span 
class="ptmri7t-">bisect </span>extension does is use its knowledge of the &#x201C;shape&#x201D; of your project&#x2019;s revision history to perform a search
in time proportional to the <span 
class="ptmri7t-">logarithm </span>of the number of changesets to check (the kind of search it performs is
called a dichotomic search). With this approach, searching through 10,000 changesets will take less than two
hours, even at ten minutes per test. Limit your search to the last 500 changesets, and it will take less than an
hour.
</p><!--l. 549--><p class="indent" >   The <a 
 id="dx13-188008"></a><span 
class="pcrr7tn-">bisect </span>extension is aware of the &#x201C;branchy&#x201D; nature of a Mercurial project&#x2019;s revision history, so it has no problems
dealing with branches, merges, or multiple heads in a repoository. It can prune entire branches of history with a single probe,
which is how it operates so efficiently.
</p><!--l. 555--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.5.1    </span> <a 
 id="x13-1890009.5.1"></a>Using the <span 
class="pcrr7tn-">bisect </span>extension</h4>
<!--l. 557--><p class="noindent" >Here&#x2019;s an example of <a 
 id="dx13-189001"></a><span 
class="pcrr7tn-">bisect </span>in action. To keep the core of Mercurial simple, <a 
 id="dx13-189002"></a><span 
class="pcrr7tn-">bisect </span>is packaged as an extension; this means
that it won&#x2019;t be present unless you explicitly enable it. To do this, edit your <a 
 id="dx13-189003"></a><a 
 id="dx13-189004"></a><span 
class="pcrr7tn-">hgrc</span>&#x00A0;and add the following section header (if it&#x2019;s
not already present):
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189006r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;[extensions]</span>
   </div>
<!--l. 565--><p class="noindent" >Then add a line to this section to enable the extension:
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189008r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;hbisect</span><span 
class="pcrr7tn-">&#x00A0;=</span>
   </div>
                                                                                         
                                                                                         
<div class="fbox"><table class="minipage"><tr><td><span 
class="ptmb7t-">Note:  </span>That&#x2019;s right, there&#x2019;s a &#x201C;<span 
class="pcrr7tn-">h</span>&#x201D; at the front of the name of the <a 
 id="dx13-189009"></a><span 
class="pcrr7tn-">bisect </span>extension.
The  reason  is  that  Mercurial  is  written  in  Python,  and  uses  a  standard  Python
package called <span 
class="pcrr7tn-">bisect</span>. If you omit the &#x201C;<span 
class="pcrr7tn-">h</span>&#x201D; from the name &#x201C;<span 
class="pcrr7tn-">hbisect</span>&#x201D;, Mercurial
will erroneously find the standard Python <span 
class="pcrr7tn-">bisect </span>package, and try to use it as a
Mercurial extension. This won&#x2019;t work, and Mercurial will crash repeatedly until
you fix the spelling in your <a 
 id="dx13-189010"></a><a 
 id="dx13-189011"></a><span 
class="pcrr7tn-">hgrc</span>. Ugh.                                 </td></tr></table></div>
<!--l. 580--><p class="indent" >   Now let&#x2019;s create a repository, so that we can try out the <a 
 id="dx13-189012"></a><span 
class="pcrr7tn-">bisect </span>extension in isolation.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189014r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;init</span><span 
class="pcrb7t-">&#x00A0;mybug</span>
<br class="fancyvrb" /><a 
 id="x13-189016r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">cd</span><span 
class="pcrb7t-">&#x00A0;mybug</span>
   </div>
<!--l. 583--><p class="noindent" >We&#x2019;ll simulate a project that has a bug in it in a simple-minded way: create trivial changes in a loop, and nominate one specific
change that will have the &#x201C;bug&#x201D;. This loop creates 35 changesets, each adding a single file to the repository. We&#x2019;ll represent our
&#x201C;bug&#x201D; with a file that contains the text &#x201C;i have a gub&#x201D;.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189018r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">buggy_change=22</span>
<br class="fancyvrb" /><a 
 id="x13-189020r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">for</span><span 
class="pcrb7t-">&#x00A0;((</span><span 
class="pcrb7t-">&#x00A0;i</span><span 
class="pcrb7t-">&#x00A0;=</span><span 
class="pcrb7t-">&#x00A0;0;</span><span 
class="pcrb7t-">&#x00A0;i</span><span 
class="pcrb7t-">&#x00A0;&#x003c;</span><span 
class="pcrb7t-">&#x00A0;35;</span><span 
class="pcrb7t-">&#x00A0;i++</span><span 
class="pcrb7t-">&#x00A0;));</span><span 
class="pcrb7t-">&#x00A0;do</span>
<br class="fancyvrb" /><a 
 id="x13-189022r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;if</span><span 
class="pcrb7t-">&#x00A0;[[</span><span 
class="pcrb7t-">&#x00A0;$i</span><span 
class="pcrb7t-">&#x00A0;=</span><span 
class="pcrb7t-">&#x00A0;$buggy_change</span><span 
class="pcrb7t-">&#x00A0;]];</span><span 
class="pcrb7t-">&#x00A0;then</span>
<br class="fancyvrb" /><a 
 id="x13-189024r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;echo</span><span 
class="pcrb7t-">&#x00A0;'i</span><span 
class="pcrb7t-">&#x00A0;have</span><span 
class="pcrb7t-">&#x00A0;a</span><span 
class="pcrb7t-">&#x00A0;gub'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;myfile$i</span>
<br class="fancyvrb" /><a 
 id="x13-189026r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-q</span><span 
class="pcrb7t-">&#x00A0;-A</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'buggy</span><span 
class="pcrb7t-">&#x00A0;changeset'</span>
<br class="fancyvrb" /><a 
 id="x13-189028r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;else</span>
<br class="fancyvrb" /><a 
 id="x13-189030r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;echo</span><span 
class="pcrb7t-">&#x00A0;'nothing</span><span 
class="pcrb7t-">&#x00A0;to</span><span 
class="pcrb7t-">&#x00A0;see</span><span 
class="pcrb7t-">&#x00A0;here,</span><span 
class="pcrb7t-">&#x00A0;move</span><span 
class="pcrb7t-">&#x00A0;along'</span><span 
class="pcrb7t-">&#x00A0;&#x003e;</span><span 
class="pcrb7t-">&#x00A0;myfile$i</span>
<br class="fancyvrb" /><a 
 id="x13-189032r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;hg</span><span 
class="pcrb7t-">&#x00A0;commit</span><span 
class="pcrb7t-">&#x00A0;-q</span><span 
class="pcrb7t-">&#x00A0;-A</span><span 
class="pcrb7t-">&#x00A0;-m</span><span 
class="pcrb7t-">&#x00A0;'normal</span><span 
class="pcrb7t-">&#x00A0;changeset'</span>
<br class="fancyvrb" /><a 
 id="x13-189034r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;fi</span>
<br class="fancyvrb" /><a 
 id="x13-189036r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">done</span>
   </div>
<!--l. 590--><p class="indent" >   The next thing that we&#x2019;d like to do is figure out how to use the <a 
 id="dx13-189037"></a><span 
class="pcrr7tn-">bisect </span>extension. We can use Mercurial&#x2019;s normal built-in
help mechanism for this.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189039r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;help</span><span 
class="pcrb7t-">&#x00A0;bisect</span>
<br class="fancyvrb" /><a 
 id="x13-189041r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;hg</span><span 
class="pcrr7tn-">&#x00A0;bisect</span><span 
class="pcrr7tn-">&#x00A0;[help|init|reset|next|good|bad]</span>
<br class="fancyvrb" /><a 
 id="x13-189043r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-189045r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Dichotomic</span><span 
class="pcrr7tn-">&#x00A0;search</span><span 
class="pcrr7tn-">&#x00A0;in</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;DAG</span><span 
class="pcrr7tn-">&#x00A0;of</span><span 
class="pcrr7tn-">&#x00A0;changesets</span>
<br class="fancyvrb" /><a 
 id="x13-189047r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-189049r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;This</span><span 
class="pcrr7tn-">&#x00A0;extension</span><span 
class="pcrr7tn-">&#x00A0;helps</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;find</span><span 
class="pcrr7tn-">&#x00A0;changesets</span><span 
class="pcrr7tn-">&#x00A0;which</span><span 
class="pcrr7tn-">&#x00A0;cause</span><span 
class="pcrr7tn-">&#x00A0;problems.</span>
<br class="fancyvrb" /><a 
 id="x13-189051r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;To</span><span 
class="pcrr7tn-">&#x00A0;use,</span><span 
class="pcrr7tn-">&#x00A0;mark</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;earliest</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;you</span><span 
class="pcrr7tn-">&#x00A0;know</span><span 
class="pcrr7tn-">&#x00A0;introduces</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;problem</span>
<br class="fancyvrb" /><a 
 id="x13-189053r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;as</span><span 
class="pcrr7tn-">&#x00A0;bad,</span><span 
class="pcrr7tn-">&#x00A0;then</span><span 
class="pcrr7tn-">&#x00A0;mark</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;latest</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;which</span><span 
class="pcrr7tn-">&#x00A0;is</span><span 
class="pcrr7tn-">&#x00A0;free</span><span 
class="pcrr7tn-">&#x00A0;from</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;problem</span>
<br class="fancyvrb" /><a 
 id="x13-189055r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;as</span><span 
class="pcrr7tn-">&#x00A0;good.</span><span 
class="pcrr7tn-">&#x00A0;Bisect</span><span 
class="pcrr7tn-">&#x00A0;will</span><span 
class="pcrr7tn-">&#x00A0;update</span><span 
class="pcrr7tn-">&#x00A0;your</span><span 
class="pcrr7tn-">&#x00A0;working</span><span 
class="pcrr7tn-">&#x00A0;directory</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;for</span>
<br class="fancyvrb" /><a 
 id="x13-189057r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;testing.</span><span 
class="pcrr7tn-">&#x00A0;Once</span><span 
class="pcrr7tn-">&#x00A0;you</span><span 
class="pcrr7tn-">&#x00A0;have</span><span 
class="pcrr7tn-">&#x00A0;performed</span><span 
class="pcrr7tn-">&#x00A0;tests,</span><span 
class="pcrr7tn-">&#x00A0;mark</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;working</span><span 
class="pcrr7tn-">&#x00A0;directory</span>
<br class="fancyvrb" /><a 
 id="x13-189059r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;as</span><span 
class="pcrr7tn-">&#x00A0;bad</span><span 
class="pcrr7tn-">&#x00A0;or</span><span 
class="pcrr7tn-">&#x00A0;good</span><span 
class="pcrr7tn-">&#x00A0;and</span><span 
class="pcrr7tn-">&#x00A0;bisect</span><span 
class="pcrr7tn-">&#x00A0;will</span><span 
class="pcrr7tn-">&#x00A0;either</span><span 
class="pcrr7tn-">&#x00A0;update</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;another</span><span 
class="pcrr7tn-">&#x00A0;candidate</span>
<br class="fancyvrb" /><a 
 id="x13-189061r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;or</span><span 
class="pcrr7tn-">&#x00A0;announce</span><span 
class="pcrr7tn-">&#x00A0;that</span><span 
class="pcrr7tn-">&#x00A0;it</span><span 
class="pcrr7tn-">&#x00A0;has</span><span 
class="pcrr7tn-">&#x00A0;found</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;bad</span><span 
class="pcrr7tn-">&#x00A0;revision.</span>
<br class="fancyvrb" /><a 
 id="x13-189063r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-189065r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Note:</span><span 
class="pcrr7tn-">&#x00A0;bisect</span><span 
class="pcrr7tn-">&#x00A0;expects</span><span 
class="pcrr7tn-">&#x00A0;bad</span><span 
class="pcrr7tn-">&#x00A0;revisions</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;be</span><span 
class="pcrr7tn-">&#x00A0;descendants</span><span 
class="pcrr7tn-">&#x00A0;of</span><span 
class="pcrr7tn-">&#x00A0;good</span><span 
class="pcrr7tn-">&#x00A0;revisions.</span>
<br class="fancyvrb" /><a 
 id="x13-189067r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;If</span><span 
class="pcrr7tn-">&#x00A0;you</span><span 
class="pcrr7tn-">&#x00A0;are</span><span 
class="pcrr7tn-">&#x00A0;looking</span><span 
class="pcrr7tn-">&#x00A0;for</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;point</span><span 
class="pcrr7tn-">&#x00A0;at</span><span 
class="pcrr7tn-">&#x00A0;which</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;problem</span><span 
class="pcrr7tn-">&#x00A0;was</span><span 
class="pcrr7tn-">&#x00A0;fixed,</span><span 
class="pcrr7tn-">&#x00A0;then</span><span 
class="pcrr7tn-">&#x00A0;make</span>
<br class="fancyvrb" /><a 
 id="x13-189069r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;problem-free</span><span 
class="pcrr7tn-">&#x00A0;state</span><span 
class="pcrr7tn-">&#x00A0;"bad"</span><span 
class="pcrr7tn-">&#x00A0;and</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;problematic</span><span 
class="pcrr7tn-">&#x00A0;state</span><span 
class="pcrr7tn-">&#x00A0;"good."</span>
<br class="fancyvrb" /><a 
 id="x13-189071r17"></a><span 
class="ptmr7t-x-x-50">17</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
                                                                                         
                                                                                         
<br class="fancyvrb" /><a 
 id="x13-189073r18"></a><span 
class="ptmr7t-x-x-50">18</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;For</span><span 
class="pcrr7tn-">&#x00A0;subcommands</span><span 
class="pcrr7tn-">&#x00A0;see</span><span 
class="pcrr7tn-">&#x00A0;"hg</span><span 
class="pcrr7tn-">&#x00A0;bisect</span><span 
class="pcrr7tn-">&#x00A0;help"</span>
<br class="fancyvrb" /><a 
 id="x13-189075r19"></a><span 
class="ptmr7t-x-x-50">19</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-189077r20"></a><span 
class="ptmr7t-x-x-50">20</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;use</span><span 
class="pcrr7tn-">&#x00A0;"hg</span><span 
class="pcrr7tn-">&#x00A0;-v</span><span 
class="pcrr7tn-">&#x00A0;help</span><span 
class="pcrr7tn-">&#x00A0;bisect"</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;show</span><span 
class="pcrr7tn-">&#x00A0;global</span><span 
class="pcrr7tn-">&#x00A0;options</span>
<br class="fancyvrb" /><a 
 id="x13-189079r21"></a><span 
class="ptmr7t-x-x-50">21</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;bisect</span><span 
class="pcrb7t-">&#x00A0;help</span>
<br class="fancyvrb" /><a 
 id="x13-189081r22"></a><span 
class="ptmr7t-x-x-50">22</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;list</span><span 
class="pcrr7tn-">&#x00A0;of</span><span 
class="pcrr7tn-">&#x00A0;subcommands</span><span 
class="pcrr7tn-">&#x00A0;for</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;bisect</span><span 
class="pcrr7tn-">&#x00A0;extension</span>
<br class="fancyvrb" /><a 
 id="x13-189083r23"></a><span 
class="ptmr7t-x-x-50">23</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
<br class="fancyvrb" /><a 
 id="x13-189085r24"></a><span 
class="ptmr7t-x-x-50">24</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;bad</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;mark</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;as</span><span 
class="pcrr7tn-">&#x00A0;bad</span><span 
class="pcrr7tn-">&#x00A0;and</span><span 
class="pcrr7tn-">&#x00A0;update</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;next</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;test</span>
<br class="fancyvrb" /><a 
 id="x13-189087r25"></a><span 
class="ptmr7t-x-x-50">25</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;good</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;mark</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;as</span><span 
class="pcrr7tn-">&#x00A0;good</span><span 
class="pcrr7tn-">&#x00A0;and</span><span 
class="pcrr7tn-">&#x00A0;update</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;next</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;test</span>
<br class="fancyvrb" /><a 
 id="x13-189089r26"></a><span 
class="ptmr7t-x-x-50">26</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;help</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;show</span><span 
class="pcrr7tn-">&#x00A0;help</span><span 
class="pcrr7tn-">&#x00A0;for</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;given</span><span 
class="pcrr7tn-">&#x00A0;bisect</span><span 
class="pcrr7tn-">&#x00A0;subcommand</span><span 
class="pcrr7tn-">&#x00A0;or</span><span 
class="pcrr7tn-">&#x00A0;all</span><span 
class="pcrr7tn-">&#x00A0;subcommands</span>
<br class="fancyvrb" /><a 
 id="x13-189091r27"></a><span 
class="ptmr7t-x-x-50">27</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;init</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;start</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;new</span><span 
class="pcrr7tn-">&#x00A0;bisection</span>
<br class="fancyvrb" /><a 
 id="x13-189093r28"></a><span 
class="ptmr7t-x-x-50">28</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;next</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;find</span><span 
class="pcrr7tn-">&#x00A0;and</span><span 
class="pcrr7tn-">&#x00A0;update</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;the</span><span 
class="pcrr7tn-">&#x00A0;next</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;to</span><span 
class="pcrr7tn-">&#x00A0;test</span>
<br class="fancyvrb" /><a 
 id="x13-189095r29"></a><span 
class="ptmr7t-x-x-50">29</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;reset</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;finish</span><span 
class="pcrr7tn-">&#x00A0;a</span><span 
class="pcrr7tn-">&#x00A0;bisection</span>
   </div>
<!--l. 595--><p class="indent" >   The <a 
 id="dx13-189096"></a><span 
class="pcrr7tn-">bisect </span>extension works in steps. Each step proceeds as follows.
     </p><ol  class="enumerate1" >
     <li 
  class="enumerate" id="x13-189098x1">You run your binary test.
         <ul><li><span class="dt">
         </span><span class="dd">If the test succeeded, you tell <a 
 id="dx13-189099"></a><span 
class="pcrr7tn-">bisect </span>by running the <a 
 id="dx13-189100"></a>&#x201C;<span 
class="pcrr7tn-">hg bisect good</span>&#x201D; command.
         </span><li><span class="dt">
         </span><span class="dd">If it failed, use the <a 
 id="dx13-189101"></a>&#x201C;<span 
class="pcrr7tn-">hg bisect bad</span>&#x201D; command to let the <a 
 id="dx13-189102"></a><span 
class="pcrr7tn-">bisect </span>extension know.</li></ul>
     </li>
     <li 
  class="enumerate" id="x13-189104x2">The extension uses your information to decide which changeset to test next.
     </li>
     <li 
  class="enumerate" id="x13-189106x3">It updates the working directory to that changeset, and the process begins again.</li></ol>
<!--l. 609--><p class="noindent" >The process ends when <a 
 id="dx13-189107"></a><span 
class="pcrr7tn-">bisect </span>identifies a unique changeset that marks the point where your test transitioned from &#x201C;succeeding&#x201D;
to &#x201C;failing&#x201D;.
</p><!--l. 613--><p class="indent" >   To start the search, we must run the <a 
 id="dx13-189108"></a>&#x201C;<span 
class="pcrr7tn-">hg bisect init</span>&#x201D; command.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189110r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;bisect</span><span 
class="pcrb7t-">&#x00A0;init</span>
<br class="fancyvrb" /><a 
 id="x13-189112r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;abort:</span><span 
class="pcrr7tn-">&#x00A0;bisect</span><span 
class="pcrr7tn-">&#x00A0;directory</span><span 
class="pcrr7tn-">&#x00A0;already</span><span 
class="pcrr7tn-">&#x00A0;exists</span>
<br class="fancyvrb" /><a 
 id="x13-189114r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
   </div>
<!--l. 616--><p class="indent" >   In our case, the binary test we use is simple: we check to see if any file in the repository contains the string &#x201C;i have a gub&#x201D;.
If it does, this changeset contains the change that &#x201C;caused the bug&#x201D;. By convention, a changeset that has the property we&#x2019;re
searching for is &#x201C;bad&#x201D;, while one that doesn&#x2019;t is &#x201C;good&#x201D;.
</p><!--l. 622--><p class="indent" >   Most of the time, the revision to which the working directory is synced (usually the tip) already exhibits the problem
introduced by the buggy change, so we&#x2019;ll mark it as &#x201C;bad&#x201D;.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189116r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;bisect</span><span 
class="pcrb7t-">&#x00A0;bad</span>
   </div>
<!--l. 627--><p class="indent" >   Our next task is to nominate a changeset that we know <span 
class="ptmri7t-">doesn&#x2019;t </span>have the bug; the <a 
 id="dx13-189117"></a><span 
class="pcrr7tn-">bisect </span>extension will &#x201C;bracket&#x201D; its search
between the first pair of good and bad changesets. In our case, we know that revision&#x00A0;10 didn&#x2019;t have the bug. (I&#x2019;ll have more
words about choosing the first &#x201C;good&#x201D; changeset later.)
                                                                                         
                                                                                         
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189119r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;bisect</span><span 
class="pcrb7t-">&#x00A0;good</span><span 
class="pcrb7t-">&#x00A0;10</span>
<br class="fancyvrb" /><a 
 id="x13-189121r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Testing</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;22:baeda37353e3</span><span 
class="pcrr7tn-">&#x00A0;(24</span><span 
class="pcrr7tn-">&#x00A0;changesets</span><span 
class="pcrr7tn-">&#x00A0;remaining,</span><span 
class="pcrr7tn-">&#x00A0;~4</span><span 
class="pcrr7tn-">&#x00A0;tests)</span>
<br class="fancyvrb" /><a 
 id="x13-189123r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;12</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
   </div>
<!--l. 634--><p class="indent" >   Notice that this command printed some output. </p>
     <ul><li><span class="dt">
     </span><span class="dd">It told us how many changesets it must consider before it can identify the one that introduced the bug, and how
     many tests that will require.
     </span><li><span class="dt">
     </span><span class="dd">It updated the working directory to the next changeset to test, and told us which changeset it&#x2019;s testing.</li></ul>
<!--l. 643--><p class="indent" >   We now run our test in the working directory. We use the <a 
 id="dx13-189124"></a><span 
class="pcrr7tn-">grep </span>command to see if our &#x201C;bad&#x201D; file is present in the working
directory. If it is, this revision is bad; if not, this revision is good.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189126r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">if</span><span 
class="pcrb7t-">&#x00A0;grep</span><span 
class="pcrb7t-">&#x00A0;-q</span><span 
class="pcrb7t-">&#x00A0;'i</span><span 
class="pcrb7t-">&#x00A0;have</span><span 
class="pcrb7t-">&#x00A0;a</span><span 
class="pcrb7t-">&#x00A0;gub'</span><span 
class="pcrb7t-">&#x00A0;&#x22C6;</span>
<br class="fancyvrb" /><a 
 id="x13-189128r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">then</span>
<br class="fancyvrb" /><a 
 id="x13-189130r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;result=bad</span>
<br class="fancyvrb" /><a 
 id="x13-189132r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">else</span>
<br class="fancyvrb" /><a 
 id="x13-189134r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;result=good</span>
<br class="fancyvrb" /><a 
 id="x13-189136r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">fi</span>
<br class="fancyvrb" /><a 
 id="x13-189138r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">echo</span><span 
class="pcrb7t-">&#x00A0;this</span><span 
class="pcrb7t-">&#x00A0;revision</span><span 
class="pcrb7t-">&#x00A0;is</span><span 
class="pcrb7t-">&#x00A0;$result</span>
<br class="fancyvrb" /><a 
 id="x13-189140r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;this</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;is</span><span 
class="pcrr7tn-">&#x00A0;bad</span>
<br class="fancyvrb" /><a 
 id="x13-189142r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;bisect</span><span 
class="pcrb7t-">&#x00A0;$result</span>
<br class="fancyvrb" /><a 
 id="x13-189144r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Testing</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;16:f410b84eca1c</span><span 
class="pcrr7tn-">&#x00A0;(12</span><span 
class="pcrr7tn-">&#x00A0;changesets</span><span 
class="pcrr7tn-">&#x00A0;remaining,</span><span 
class="pcrr7tn-">&#x00A0;~3</span><span 
class="pcrr7tn-">&#x00A0;tests)</span>
<br class="fancyvrb" /><a 
 id="x13-189146r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;6</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
   </div>
<!--l. 649--><p class="indent" >   This test looks like a perfect candidate for automation, so let&#x2019;s turn it into a shell function.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189148r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">mytest()</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="cmsy-10">{</span>
<br class="fancyvrb" /><a 
 id="x13-189150r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;if</span><span 
class="pcrb7t-">&#x00A0;grep</span><span 
class="pcrb7t-">&#x00A0;-q</span><span 
class="pcrb7t-">&#x00A0;'i</span><span 
class="pcrb7t-">&#x00A0;have</span><span 
class="pcrb7t-">&#x00A0;a</span><span 
class="pcrb7t-">&#x00A0;gub'</span><span 
class="pcrb7t-">&#x00A0;&#x22C6;</span>
<br class="fancyvrb" /><a 
 id="x13-189152r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;then</span>
<br class="fancyvrb" /><a 
 id="x13-189154r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;result=bad</span>
<br class="fancyvrb" /><a 
 id="x13-189156r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;else</span>
<br class="fancyvrb" /><a 
 id="x13-189158r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;result=good</span>
<br class="fancyvrb" /><a 
 id="x13-189160r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;fi</span>
<br class="fancyvrb" /><a 
 id="x13-189162r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;echo</span><span 
class="pcrb7t-">&#x00A0;this</span><span 
class="pcrb7t-">&#x00A0;revision</span><span 
class="pcrb7t-">&#x00A0;is</span><span 
class="pcrb7t-">&#x00A0;$result</span>
<br class="fancyvrb" /><a 
 id="x13-189164r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;</span><span 
class="pcrb7t-">&#x00A0;hg</span><span 
class="pcrb7t-">&#x00A0;bisect</span><span 
class="pcrb7t-">&#x00A0;$result</span>
<br class="fancyvrb" /><a 
 id="x13-189166r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;&#x003e;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="cmsy-10">}</span>
   </div>
<!--l. 652--><p class="noindent" >We can now run an entire test step with a single command, <span 
class="pcrr7tn-">mytest</span>.
</p>
   <div class="fancyvrb" id="fancyvrb">
                                                                                         
                                                                                         
<a 
 id="x13-189168r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">mytest</span>
<br class="fancyvrb" /><a 
 id="x13-189170r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;this</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;is</span><span 
class="pcrr7tn-">&#x00A0;good</span>
<br class="fancyvrb" /><a 
 id="x13-189172r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Testing</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;19:f4dcc543ad84</span><span 
class="pcrr7tn-">&#x00A0;(6</span><span 
class="pcrr7tn-">&#x00A0;changesets</span><span 
class="pcrr7tn-">&#x00A0;remaining,</span><span 
class="pcrr7tn-">&#x00A0;~2</span><span 
class="pcrr7tn-">&#x00A0;tests)</span>
<br class="fancyvrb" /><a 
 id="x13-189174r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;3</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
   </div>
<!--l. 655--><p class="noindent" >A few more invocations of our canned test step command, and we&#x2019;re done.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-189176r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">mytest</span>
<br class="fancyvrb" /><a 
 id="x13-189178r2"></a><span 
class="ptmr7t-x-x-50">2</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;this</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;is</span><span 
class="pcrr7tn-">&#x00A0;good</span>
<br class="fancyvrb" /><a 
 id="x13-189180r3"></a><span 
class="ptmr7t-x-x-50">3</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Testing</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;20:67d386ac9c6a</span><span 
class="pcrr7tn-">&#x00A0;(3</span><span 
class="pcrr7tn-">&#x00A0;changesets</span><span 
class="pcrr7tn-">&#x00A0;remaining,</span><span 
class="pcrr7tn-">&#x00A0;~1</span><span 
class="pcrr7tn-">&#x00A0;tests)</span>
<br class="fancyvrb" /><a 
 id="x13-189182r4"></a><span 
class="ptmr7t-x-x-50">4</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
<br class="fancyvrb" /><a 
 id="x13-189184r5"></a><span 
class="ptmr7t-x-x-50">5</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">mytest</span>
<br class="fancyvrb" /><a 
 id="x13-189186r6"></a><span 
class="ptmr7t-x-x-50">6</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;this</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;is</span><span 
class="pcrr7tn-">&#x00A0;good</span>
<br class="fancyvrb" /><a 
 id="x13-189188r7"></a><span 
class="ptmr7t-x-x-50">7</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Testing</span><span 
class="pcrr7tn-">&#x00A0;changeset</span><span 
class="pcrr7tn-">&#x00A0;21:18b8376e673d</span><span 
class="pcrr7tn-">&#x00A0;(2</span><span 
class="pcrr7tn-">&#x00A0;changesets</span><span 
class="pcrr7tn-">&#x00A0;remaining,</span><span 
class="pcrr7tn-">&#x00A0;~1</span><span 
class="pcrr7tn-">&#x00A0;tests)</span>
<br class="fancyvrb" /><a 
 id="x13-189190r8"></a><span 
class="ptmr7t-x-x-50">8</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;1</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;updated,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;merged,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;removed,</span><span 
class="pcrr7tn-">&#x00A0;0</span><span 
class="pcrr7tn-">&#x00A0;files</span><span 
class="pcrr7tn-">&#x00A0;unresolved</span>
<br class="fancyvrb" /><a 
 id="x13-189192r9"></a><span 
class="ptmr7t-x-x-50">9</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">mytest</span>
<br class="fancyvrb" /><a 
 id="x13-189194r10"></a><span 
class="ptmr7t-x-x-50">10</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;this</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;is</span><span 
class="pcrr7tn-">&#x00A0;good</span>
<br class="fancyvrb" /><a 
 id="x13-189196r11"></a><span 
class="ptmr7t-x-x-50">11</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;The</span><span 
class="pcrr7tn-">&#x00A0;first</span><span 
class="pcrr7tn-">&#x00A0;bad</span><span 
class="pcrr7tn-">&#x00A0;revision</span><span 
class="pcrr7tn-">&#x00A0;is:</span>
<br class="fancyvrb" /><a 
 id="x13-189198r12"></a><span 
class="ptmr7t-x-x-50">12</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;changeset:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;22:baeda37353e3</span>
<br class="fancyvrb" /><a 
 id="x13-189200r13"></a><span 
class="ptmr7t-x-x-50">13</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;user:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Bryan</span><span 
class="pcrr7tn-">&#x00A0;O'Sullivan</span><span 
class="pcrr7tn-">&#x00A0;&#x003c;bos@serpentine.com&#x003e;</span>
<br class="fancyvrb" /><a 
 id="x13-189202r14"></a><span 
class="ptmr7t-x-x-50">14</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;date:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;Mon</span><span 
class="pcrr7tn-">&#x00A0;Dec</span><span 
class="pcrr7tn-">&#x00A0;10</span><span 
class="pcrr7tn-">&#x00A0;19:54:17</span><span 
class="pcrr7tn-">&#x00A0;2007</span><span 
class="pcrr7tn-">&#x00A0;+0000</span>
<br class="fancyvrb" /><a 
 id="x13-189204r15"></a><span 
class="ptmr7t-x-x-50">15</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;summary:</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;buggy</span><span 
class="pcrr7tn-">&#x00A0;changeset</span>
<br class="fancyvrb" /><a 
 id="x13-189206r16"></a><span 
class="ptmr7t-x-x-50">16</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;</span>
   </div>
<!--l. 659--><p class="indent" >   Even though we had&#x00A0;40 changesets to search through, the <a 
 id="dx13-189207"></a><span 
class="pcrr7tn-">bisect </span>extension let us find the changeset that introduced our
&#x201C;bug&#x201D; with only five tests. Because the number of tests that the <a 
 id="dx13-189208"></a><span 
class="pcrr7tn-">bisect </span>extension grows logarithmically with the number of
changesets to search, the advantage that it has over the &#x201C;brute force&#x201D; search approach increases with every changeset you
add.
</p><!--l. 666--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.5.2    </span> <a 
 id="x13-1900009.5.2"></a>Cleaning up after your search</h4>
<!--l. 668--><p class="noindent" >When you&#x2019;re finished using the <a 
 id="dx13-190001"></a><span 
class="pcrr7tn-">bisect </span>extension in a repository, you can use the <a 
 id="dx13-190002"></a>&#x201C;<span 
class="pcrr7tn-">hg bisect reset</span>&#x201D; command to drop the
information it was using to drive your search. The extension doesn&#x2019;t use much space, so it doesn&#x2019;t matter if you forget to run
this command. However, <a 
 id="dx13-190003"></a><span 
class="pcrr7tn-">bisect </span>won&#x2019;t let you start a new search in that repository until you do a <a 
 id="dx13-190004"></a>&#x201C;<span 
class="pcrr7tn-">hg bisect</span>
<span 
class="pcrr7tn-">reset</span>&#x201D;.
</p>
   <div class="fancyvrb" id="fancyvrb">
<a 
 id="x13-190006r1"></a><span 
class="ptmr7t-x-x-50">1</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrr7tn-">&#x00A0;$</span><span 
class="pcrr7tn-">&#x00A0;</span><span 
class="pcrb7t-">hg</span><span 
class="pcrb7t-">&#x00A0;bisect</span><span 
class="pcrb7t-">&#x00A0;reset</span>
   </div>
<!--l. 676--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">9.6    </span> <a 
 id="x13-1910009.6"></a>Tips for finding bugs effectively</h3>
                                                                                         
                                                                                         
<!--l. 678--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.6.1    </span> <a 
 id="x13-1920009.6.1"></a>Give consistent input</h4>
<!--l. 680--><p class="noindent" >The <a 
 id="dx13-192001"></a><span 
class="pcrr7tn-">bisect </span>extension requires that you correctly report the result of every test you perform. If you tell it that a test failed when
it really succeeded, it <span 
class="ptmri7t-">might </span>be able to detect the inconsistency. If it can identify an inconsistency in your reports, it will tell you
that a particular changeset is both good and bad. However, it can&#x2019;t do this perfectly; it&#x2019;s about as likely to report the wrong
changeset as the source of the bug.
</p><!--l. 688--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.6.2    </span> <a 
 id="x13-1930009.6.2"></a>Automate as much as possible</h4>
<!--l. 690--><p class="noindent" >When I started using the <a 
 id="dx13-193001"></a><span 
class="pcrr7tn-">bisect </span>extension, I tried a few times to run my tests by hand, on the command line. This is an
approach that I, at least, am not suited to. After a few tries, I found that I was making enough mistakes that I was having to
restart my searches several times before finally getting correct results.
</p><!--l. 696--><p class="indent" >   My initial problems with driving the <a 
 id="dx13-193002"></a><span 
class="pcrr7tn-">bisect </span>extension by hand occurred even with simple searches on small repositories; if
the problem you&#x2019;re looking for is more subtle, or the number of tests that <a 
 id="dx13-193003"></a><span 
class="pcrr7tn-">bisect </span>must perform increases, the
likelihood of operator error ruining the search is much higher. Once I started automating my tests, I had much better
results.
</p><!--l. 703--><p class="indent" >   The key to automated testing is twofold: </p>
     <ul><li><span class="dt">
     </span><span class="dd">always test for the same symptom, and
     </span><li><span class="dt">
     </span><span class="dd">always feed consistent input to the <a 
 id="dx13-193004"></a>&#x201C;<span 
class="pcrr7tn-">hg bisect</span>&#x201D; command.</li></ul>
<!--l. 708--><p class="noindent" >In my tutorial example above, the <a 
 id="dx13-193005"></a><span 
class="pcrr7tn-">grep </span>command tests for the symptom, and the <span 
class="pcrr7tn-">if </span>statement takes the result of this check and
ensures that we always feed the same input to the <a 
 id="dx13-193006"></a>&#x201C;<span 
class="pcrr7tn-">hg bisect</span>&#x201D; command. The <span 
class="pcrr7tn-">mytest </span>function marries these together in a
reproducible way, so that every test is uniform and consistent.
</p><!--l. 714--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.6.3    </span> <a 
 id="x13-1940009.6.3"></a>Check your results</h4>
<!--l. 716--><p class="noindent" >Because the output of a <a 
 id="dx13-194001"></a><span 
class="pcrr7tn-">bisect </span>search is only as good as the input you give it, don&#x2019;t take the changeset it reports as the absolute
truth. A simple way to cross-check its report is to manually run your test at each of the following changesets:
</p>
     <ul><li><span class="dt">
     </span><span class="dd">The changeset that it reports as the first bad revision. Your test should still report this as bad.
     </span><li><span class="dt">
     </span><span class="dd">The parent of that changeset (either parent, if it&#x2019;s a merge). Your test should report this changeset as good.
     </span><li><span class="dt">
     </span><span class="dd">A child of that changeset. Your test should report this changeset as bad.</li></ul>
                                                                                         
                                                                                         
<!--l. 729--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.6.4    </span> <a 
 id="x13-1950009.6.4"></a>Beware interference between bugs</h4>
<!--l. 731--><p class="noindent" >It&#x2019;s possible that your search for one bug could be disrupted by the presence of another. For example, let&#x2019;s say your
software crashes at revision 100, and worked correctly at revision 50. Unknown to you, someone else introduced a
different crashing bug at revision 60, and fixed it at revision 80. This could distort your results in one of several
ways.
</p><!--l. 738--><p class="indent" >   It is possible that this other bug completely &#x201C;masks&#x201D; yours, which is to say that it occurs before your bug has a chance to
manifest itself. If you can&#x2019;t avoid that other bug (for example, it prevents your project from building), and so
can&#x2019;t tell whether your bug is present in a particular changeset, the <a 
 id="dx13-195001"></a><span 
class="pcrr7tn-">bisect </span>extension cannot help you directly.
Instead, you&#x2019;ll need to manually avoid the changesets where that bug is present, and do separate searches &#x201C;around&#x201D;
it.
</p><!--l. 747--><p class="indent" >   A different problem could arise if your test for a bug&#x2019;s presence is not specific enough. If you check for &#x201C;my program
crashes&#x201D;, then both your crashing bug and an unrelated crashing bug that masks it will look like the same thing, and mislead
<a 
 id="dx13-195002"></a><span 
class="pcrr7tn-">bisect</span>.
</p><!--l. 752--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">9.6.5    </span> <a 
 id="x13-1960009.6.5"></a>Bracket your search lazily</h4>
<!--l. 754--><p class="noindent" >Choosing the first &#x201C;good&#x201D; and &#x201C;bad&#x201D; changesets that will mark the end points of your search is often easy, but it bears a little
discussion nevertheless. From the perspective of <a 
 id="dx13-196001"></a><span 
class="pcrr7tn-">bisect</span>, the &#x201C;newest&#x201D; changeset is conventionally &#x201C;bad&#x201D;, and the older
changeset is &#x201C;good&#x201D;.
</p><!--l. 760--><p class="indent" >   If you&#x2019;re having trouble remembering when a suitable &#x201C;good&#x201D; change was, so that you can tell <a 
 id="dx13-196002"></a><span 
class="pcrr7tn-">bisect</span>, you could do worse
than testing changesets at random. Just remember to eliminate contenders that can&#x2019;t possibly exhibit the bug (perhaps
because the feature with the bug isn&#x2019;t present yet) and those where another problem masks the bug (as I discussed
above).
</p><!--l. 767--><p class="indent" >   Even if you end up &#x201C;early&#x201D; by thousands of changesets or months of history, you will only add a handful of tests to the total
number that <a 
 id="dx13-196003"></a><span 
class="pcrr7tn-">bisect </span>must perform, thanks to its logarithmic behaviour.
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
                                                                                         
</p>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="hgbookch10.html" >next</a>] [<a 
href="hgbookch8.html" >prev</a>] [<a 
href="hgbookch8.html#tailhgbookch8.html" >prev-tail</a>] [<a 
href="hgbookch9.html" >front</a>] [<a 
href="hgbook.html#hgbookch9.html" >up</a>] </p></div>
<!--l. 1--><p class="indent" >   <a 
 id="tailhgbookch9.html"></a>   </p> 
</body></html> 
